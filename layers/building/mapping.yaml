generalized_tables:
  # etldoc: imposm3 -> osm_building_polygon_gen1
  building_polygon_gen1:
    source: building_polygon
    sql_filter: area>power(ZRES12,2) AND ST_IsValid(geometry)
    tolerance: ZRES14

tables:
  # etldoc: imposm3 -> osm_building_polygon
  building_polygon:
    columns:
    - name: osm_id
      type: id
    - name: geometry
      type: validated_geometry
    - name: area
      type: area
    - name: tags
      type: hstore_tags
    mapping:
      building:part:
      - __any__
      building:
      - __any__
      # these aeroway polygons all imply building=yes
      aeroway:
      - terminal
      - hangar
    filters:
      reject:
        building: ["no","none","No"]
        building:part: ["no","none","No"]
        man_made: ["bridge"]
    type: polygon

  # etldoc: imposm3 -> osm_building_point
  # TODO entrances, roof?
  # building_point:
  #   columns:
  #   - name: osm_id
  #     type: id
  #   - name: geometry
  #     type: geometry
  #   - name: tags
  #     type: hstore_tags
  #   mapping:
  #     building:part:
  #     - __any__
  #     building:
  #     - __any__
  #     # these aeroway polygons all imply building=yes
  #     aeroway:
  #     - terminal
  #     - hangar
  #   filters:
  #     reject:
  #       building: ["no","none","No"]
  #       building:part: ["no","none","No"]
  #       man_made: ["bridge"]
  #   type: point

  # etldoc: imposm3 -> osm_building_relation
  building_relation:
    columns:
    - name: osm_id
      type: id
    - name: geometry
      type: geometry
    # - name: area
    #   type: area
    - name: tags
      type: hstore_tags
    - name: member_tags
      type: hstore_tags
      from_member: true
    - name: member
      type: member_id
    - name: index
      type: member_index
    - name: role
      type: member_role
      from_member: true
    - name: type
      type: member_type
    mapping:
      type: [building]
    type: relation_member

tags:
  include:
  - building             # 383104148
  - building:part        # 1159042
  - building:use         # 630277 (landuse)
  - levels               # 16489
  - building:levels      # 14539 966 (coalesce levels)
  - building:level       # 19383 (for building parts?)
  - min_level            # 3181
  - building:min_level   # 76351   (coalesce min_level)
  - material             # 1209983
  - building:material    # 1462169 (coalesce material)
  - wall:material        # 35269   (coalesce material)
  - building:walls       # 83234   (coalesce material)
  - colour               # 433264
  - building:colour      # 561413  (coalesce colour)
  - height               # 13039062
  - building:height      # 52190
  - min_height           # 122064
  - building:min_height  # 875
  - building:parts       # 5369
  - building:shape       # 1625
  - building:roof:shape  # 100 096
  - roof:shape           # 2800028
  - building:roof_shape  # 3900   (coalesce roof:shape)
  - building:roof:type   # 1400   (coalesce roof:shape)
  - roof:material        # 979610
  - building:roof:material # 1550 (coalesce roof:material)
  - building:roof        # 355049 (coalesce roof:material, roof:shape)
  - roof:colour          # 901095
  - building:roof:colour # 14 192  (coalesce roof:colour)
  - roof:levels          # 601813
  - building:roof:levels # 3432   (coalesce roof:levels)
  - roof:height          # 229325
  - building:roof:height # 2413   (coalesce roof:height)
  - roof:orientation     # 354 447
  - roof:direction       # 33893     (coalesce roof:orientation)
  - building:roof:orientation # 7419 (coalesce roof:orientation)
  - roof:orientation:compass # 22166 (coalesce roof:orientation)
  - roof:ridge           # 17268
  - building:roof:ridge  # 305 (coalesce roof:ridge)
  - roof:lines           # 437 (coalesce roof:ridge)
  - roof:edge            # 11743 (roof:ridge ?)
  # - roof:extent          # 1122
  # - roof:downpipe        # 20876
